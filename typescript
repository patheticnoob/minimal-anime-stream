// From Landing.tsx playEpisode function:

// Original M3U8 URL from the source
const originalUrl = m3u8Source?.file || sourcesData.sources[0].file;
// Example: "https://megacloud.example.com/playlist.m3u8"

// Build Convex HTTP endpoint base
const raw = import.meta.env.VITE_CONVEX_URL;
let base = raw.replace("convex.cloud", "convex.site");
base = base.replace("/.well-known/convex.json", "").replace(/\/$/, "");
// Result: "https://your-project.convex.site"

// Proxy the M3U8 URL through Convex
const proxiedUrl = `${base}/proxy?url=${encodeURIComponent(originalUrl)}`;
// Result: "https://your-project.convex.site/proxy?url=https%3A%2F%2Fmegacloud.example.com%2Fplaylist.m3u8"

const proxiedTracks = (sourcesData.tracks || []).map((t) => ({
  ...t,
  kind: t.kind || "subtitles",
  file: `${base}/proxy?url=${encodeURIComponent(t.file)}`,
}));

setVideoSource(proxiedUrl);